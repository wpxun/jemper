<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Jenkins 持续集成 | 在路上</title>
  <meta name="author" content="Sven">
  
  <meta name="description" content="让大家读得懂的知识才是真知识">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="Jenkins 持续集成"/>
  <meta property="og:site_name" content="在路上"/>

  
    <meta property="og:image" content=""/>
  

  <link href="/favicon.png" rel="icon">
  <link rel="alternate" href="/atom.xml" title="在路上" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  

</head>


<body>
  <header id="header" class="inner"><div class="alignleft">
  <h1><a href="/">在路上</a></h1>
  <h2><a href="/"></a></h2>
</div>
<nav id="main-nav" class="alignright">
  <ul>
    
      <li><a href="/">Home</a></li>
    
      <li><a href="/archives">Archives</a></li>
    
      <li><a href="/about">关于我</a></li>
    
  </ul>
  <div class="clearfix"></div>
</nav>
<div class="clearfix"></div>
</header>
  <div id="content" class="inner">
    <div id="main-col" class="alignleft"><div id="wrapper"><article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2019-04-28T03:59:00.000Z"><a href="/2019/04/28/jenkins/">2019-04-28</a></time>
      
      
  
    <h1 class="title">Jenkins 持续集成</h1>
  

    </header>
    <div class="entry">
      
        
			<div id="toc" class="toc-article">
				<ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-nbsp-nbsp-基础"><span class="toc-text">1   基础</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-nbsp-nbsp-安装"><span class="toc-text">1.1   安装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-nbsp-nbsp-主目录"><span class="toc-text">1.2   主目录</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-nbsp-nbsp-节点"><span class="toc-text">1.3   节点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-4-nbsp-nbsp-凭证"><span class="toc-text">1.4   凭证</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-5-nbsp-nbsp-Pipeline"><span class="toc-text">1.5   Pipeline</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-nbsp-nbsp-声明式流水线"><span class="toc-text">2   声明式流水线</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-nbsp-nbsp-构建触发器"><span class="toc-text">3   构建触发器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-nbsp-nbsp-通知"><span class="toc-text">4   通知</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-nbsp-nbsp-分布式部署实战"><span class="toc-text">7   分布式部署实战</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#7-1-nbsp-nbsp-Vagrantfile"><span class="toc-text">7.1    Vagrantfile</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-2-nbsp-nbsp-scripts"><span class="toc-text">7.2   scripts</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-3-nbsp-nbsp-运行-master-节点的-Jenkins"><span class="toc-text">7.3   运行 master 节点的 Jenkins</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-4-nbsp-nbsp-加入-node-从节点"><span class="toc-text">7.4   加入 node 从节点</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-nbsp-nbsp-Troubleshooting"><span class="toc-text">8   Troubleshooting</span></a></li></ol>
			</div>
		
        <p>今天看到《Jenkins2 权威指南》出来了，马上买了一本，DevOps 相关的书籍更新太快了，这包括 Docker、Jenkins，新特性快速推出，旧版本必然快速淘汰，可以看一下 <a href="http://mirrors.jenkins.io/war-stable/" target="_blank" rel="noopener">Jenkins 的版本</a>，Jenkins 1.x 相关书籍已经严重滞后了。<br><a id="more"></a></p>
<h2 id="1-nbsp-nbsp-基础"><a href="#1-nbsp-nbsp-基础" class="headerlink" title="1 &nbsp;&nbsp;基础"></a>1 &nbsp;&nbsp;基础</h2><h3 id="1-1-nbsp-nbsp-安装"><a href="#1-1-nbsp-nbsp-安装" class="headerlink" title="1.1 &nbsp;&nbsp;安装"></a>1.1 &nbsp;&nbsp;安装</h3><ol>
<li>作为独立的应用程序安装：（1）二进制包安装，（2）brew、yum 安装，（3）直接下载 war 包，java -jar jenkins.war。<br>更新：用 brew、yum 命令更新，或者用新版的 jenkins.war 替换旧版然后重启</li>
<li>应用服务器安装，比如 tomcat<br>更新：注意要删除一些缓存，避免过期页面被引用</li>
</ol>
<h3 id="1-2-nbsp-nbsp-主目录"><a href="#1-2-nbsp-nbsp-主目录" class="headerlink" title="1.2 &nbsp;&nbsp;主目录"></a>1.2 &nbsp;&nbsp;主目录</h3><p>不管你把 Jenkins 的 war 文件存放在哪儿，Jenkins 都把其所有重要的数据存放在一个专用的、隔离的，称为 Jenkins 主目录的目录下。在这里，Jenkins 存储关于构建服务器的配置信息、构建作业、构建产物和其他有用的信息，当然也包括你安装了的任何插件。且 Jenkins 主目录格式是跨版本向后兼容的，所以你可以自由地更新或者重新安装 Jenkins 而不影响 Jenkins 主目录。</p>
<p>一般主目录是 ~/.jenkins 目录，一个好的做法是为 Jenkins 创建一个特殊的用户和用户组。<code>sudo groupadd build</code>，<code>sudo useradd --create-home --shell /bin/bash --groups build jenkins</code>，让主目录在用户空间下。<br>确保你的 Jenkins 主目录能定期备份是非常重要的，Jenkins 程序本身相对并不那么重要。</p>
<ul>
<li>workspace：是 Jenkins 对你的项目进行构建的地方</li>
<li>builds：构建历史</li>
</ul>
<h3 id="1-3-nbsp-nbsp-节点"><a href="#1-3-nbsp-nbsp-节点" class="headerlink" title="1.3 &nbsp;&nbsp;节点"></a>1.3 &nbsp;&nbsp;节点</h3><p>节点代表了任何可以执行 Jenkins 任务的系统，包括了主节点，代理节点和容器，前两都是机器，后者是需要在机器上运行的容器，但都可以称为节点，从这点可以看出，节点是承载任务的，而不是节点机器。</p>
<ul>
<li>主节点：运行 Jenkins 实例的主要控制系统，不推荐在主节点上执行高负载任务，而应该在代理节点上运行</li>
<li>代理节点：也叫从节点，代表非主节点的系统，且由主系统管理，对资源访问有限，降低安全风险</li>
<li>容器：容器也应该选择在代理节点上运行</li>
</ul>
<h3 id="1-4-nbsp-nbsp-凭证"><a href="#1-4-nbsp-nbsp-凭证" class="headerlink" title="1.4 &nbsp;&nbsp;凭证"></a>1.4 &nbsp;&nbsp;凭证</h3><ul>
<li><p>类型：除了默认类型，还可以安装插件扩展</p>
<ul>
<li>Username with password，用户名密码</li>
<li>Docker Host Certificate Authentication</li>
<li>SSH Username with private key，ssh 连接</li>
<li>Secret file</li>
<li>Secret text，比如token</li>
<li>Certificate</li>
</ul>
</li>
<li><p>域：尽量匹配对应的域名，不过不强制</p>
<ul>
<li>全局</li>
<li>自定义域</li>
</ul>
</li>
<li><p>提供者：</p>
<ul>
<li>jenkins</li>
<li>用户</li>
</ul>
</li>
</ul>
<h3 id="1-5-nbsp-nbsp-Pipeline"><a href="#1-5-nbsp-nbsp-Pipeline" class="headerlink" title="1.5 &nbsp;&nbsp;Pipeline"></a>1.5 &nbsp;&nbsp;Pipeline</h3><p>Jenkins 2 的新特性，通过插件获得流水线这一新功能，通过 Jenkins DSL 实现流水线代码，代码提取到一个 Jenkinsfile 文件中。</p>
<ul>
<li>脚本式流水线：node 用于指定节点，偏向程序语言</li>
<li>声明式流水线：agent 用于指定节点，偏向于自然语言</li>
</ul>
<h2 id="2-nbsp-nbsp-声明式流水线"><a href="#2-nbsp-nbsp-声明式流水线" class="headerlink" title="2 &nbsp;&nbsp;声明式流水线"></a>2 &nbsp;&nbsp;声明式流水线</h2><p>创建一个流水线项目后，项目左侧列表会有“流水线语法”链接，可以借助这一脚手架直接生成 DSL 代码，比如与“构建触发”相关的可以选择 properties 步骤生成。当然想要理解声明式还得系统性地学习。</p>
<img src="http://img.jemper.cn/2019/05/declarative_pipeline.png" width="250">
<h2 id="3-nbsp-nbsp-构建触发器"><a href="#3-nbsp-nbsp-构建触发器" class="headerlink" title="3 &nbsp;&nbsp;构建触发器"></a>3 &nbsp;&nbsp;构建触发器</h2><p>除了手动立即构建，还可以构建触发器自动的构建，这也是自动化部署的基础，常用的几种构建触发器如下：</p>
<ul>
<li>其他工程构建后触发，如标题所述，允许在一个或者多个其它项目之后开发你的项目构建。依赖构建</li>
<li>定时构建，定时构建</li>
<li>Build when a change is pushed to GitLab，需要设置 webhook URL</li>
<li>GitHub hook trigger for GITScm polling，和 GitLab 一样需要在 GitHub 设置 webhook URL</li>
<li>轮询 SCM，Jenkins 主动询问</li>
</ul>
<h2 id="4-nbsp-nbsp-通知"><a href="#4-nbsp-nbsp-通知" class="headerlink" title="4 &nbsp;&nbsp;通知"></a>4 &nbsp;&nbsp;通知</h2><h2 id="7-nbsp-nbsp-分布式部署实战"><a href="#7-nbsp-nbsp-分布式部署实战" class="headerlink" title="7 &nbsp;&nbsp;分布式部署实战"></a>7 &nbsp;&nbsp;分布式部署实战</h2><p>下面通过 vagrant 进行分布式部署，主要还是用于开发和测试使用，本次实战只部署机器和环境，采用手动运行 jenkins.war。首先来看一下目录结构：<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">vagjenkins/</span><br><span class="line">├── Vagrantfile</span><br><span class="line">├── certs</span><br><span class="line">│   ├── domain.crt</span><br><span class="line">│   └── domain.key</span><br><span class="line">├── jdk-8u211-linux-x64.tar.gz</span><br><span class="line">├── jenkins.war</span><br><span class="line">└── scripts</span><br><span class="line">    ├── docker.sh</span><br><span class="line">    ├── hosts.sh</span><br><span class="line">    ├── java.sh</span><br><span class="line">    └── registry.sh</span><br></pre></td></tr></table></figure></p>
<ul>
<li>certs 和 scripts/registry.sh 是安装 Docker registry 的脚本，具体可以查看 <a href="/2019/04/13/docker-engine/#7-nbsp-nbsp-本地仓库">Docker Engine</a> 一文。</li>
<li>jdk-8u211-linux-x64.tar.gz 是运行 jenkins 的 jdk 环境工具</li>
<li>jenkins.war，在环境创建好后启动，以 java -jar jenkins.war 手动运行</li>
<li>Vagrantfile 和 scripts 在接下来重点介绍</li>
</ul>
<h3 id="7-1-nbsp-nbsp-Vagrantfile"><a href="#7-1-nbsp-nbsp-Vagrantfile" class="headerlink" title="7.1 &nbsp;&nbsp; Vagrantfile"></a>7.1 &nbsp;&nbsp; Vagrantfile</h3><ul>
<li>master 节点<ol>
<li>需要安装 Docker</li>
<li>并运行 Docker Registry 容器，并连接到Docker Registry；</li>
<li>安装 JDK 环境，预备运行 jenkins.war</li>
<li>映射 8080 端口到宿主机，访问宿主机的 localhost:8080 即是访问 master 的8080</li>
</ol>
</li>
<li>node 从节点<ol>
<li>只需安装 Docker，并连接到 master 虚拟机的 Docker Registry</li>
</ol>
</li>
</ul>
<p>Vagrantfile 就是基础设置即代码文件，可以将上述的过程代码化：<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cat &lt;&lt;EOF &gt;&gt; /Users/ada/vagjenkins/Vagrantfile</span><br><span class="line"># -*- mode: ruby -*-</span><br><span class="line"># vi:set ft=ruby sw=2 ts=2 sts=2:</span><br><span class="line"></span><br><span class="line">NODE_COUNT = 2</span><br><span class="line">POD_NETWORK_CIDR = &quot;10.244.0.0/16&quot;</span><br><span class="line"></span><br><span class="line">MASTER_IP = &quot;192.168.56.113&quot;</span><br><span class="line">NODE_IP_PREFIX = &quot;192.168.56.&quot;</span><br><span class="line"></span><br><span class="line">Vagrant.configure(&quot;2&quot;) do |config|</span><br><span class="line">  config.vm.box = &quot;centos/7&quot;</span><br><span class="line">  config.vm.box_version = &quot;1902.01&quot;</span><br><span class="line"></span><br><span class="line">  config.vm.provider &quot;virtualbox&quot; do |v|</span><br><span class="line">    v.memory = 1536</span><br><span class="line">    v.cpus = 2</span><br><span class="line">  end</span><br><span class="line"></span><br><span class="line">  config.vm.provision &quot;install-docker&quot;, type: &quot;shell&quot;, :path =&gt; &quot;scripts/docker.sh&quot;</span><br><span class="line">  config.vm.provision &quot;setup-hosts&quot;, type: &quot;shell&quot;, :path =&gt; &quot;scripts/hosts.sh&quot; do |s|</span><br><span class="line">    s.args = [&quot;eth1&quot;]</span><br><span class="line">  end</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  config.vm.define &quot;jenkins-master&quot; do |node|</span><br><span class="line">    node.vm.hostname = &quot;jenkins-master&quot;</span><br><span class="line">    node.vm.network :private_network, ip: MASTER_IP</span><br><span class="line"></span><br><span class="line">    node.vm.network &quot;forwarded_port&quot;, guest: 8080, host: 8080</span><br><span class="line"></span><br><span class="line">    node.vm.provision &quot;install-registry&quot;, type: &quot;shell&quot;, :path =&gt; &quot;scripts/registry.sh&quot;</span><br><span class="line">    node.vm.provision &quot;install-java&quot;, type: &quot;shell&quot;, :path =&gt; &quot;scripts/java.sh&quot;</span><br><span class="line"></span><br><span class="line">  end</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  (1..NODE_COUNT).each do |i|</span><br><span class="line">     config.vm.define &quot;jenkins-node0#&#123;i&#125;&quot; do |node|</span><br><span class="line">        node.vm.hostname = &quot;jenkins-node0#&#123;i&#125;&quot;</span><br><span class="line">        node.vm.network :private_network, ip: NODE_IP_PREFIX + &quot;#&#123;113 + i&#125;&quot;</span><br><span class="line"></span><br><span class="line">     end</span><br><span class="line">  end</span><br><span class="line"></span><br><span class="line">  # config all node to connect registry</span><br><span class="line">  config.vm.provision &quot;shell&quot;, inline: &lt;&lt;-SHELL</span><br><span class="line">        mkdir -p /etc/docker/certs.d/192.168.56.113:5000</span><br><span class="line">        cp /vagrant/certs/domain.crt /etc/docker/certs.d/192.168.56.113:5000/ca.crt</span><br><span class="line">    SHELL</span><br><span class="line"></span><br><span class="line">end</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure></p>
<h3 id="7-2-nbsp-nbsp-scripts"><a href="#7-2-nbsp-nbsp-scripts" class="headerlink" title="7.2 &nbsp;&nbsp;scripts"></a>7.2 &nbsp;&nbsp;scripts</h3><ol>
<li><p>Docker 安装</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cat &lt;&lt;EOF &gt;&gt; /Users/ada/vagjenkins/scripts/docker.sh</span><br><span class="line">#!/bin/bash</span><br><span class="line"></span><br><span class="line">set -ex</span><br><span class="line"></span><br><span class="line"># 安装 docker</span><br><span class="line">yum install -y yum-utils \</span><br><span class="line">  device-mapper-persistent-data \</span><br><span class="line">  lvm2</span><br><span class="line">yum-config-manager \</span><br><span class="line">    --add-repo \</span><br><span class="line">    https://download.docker.com/linux/centos/docker-ce.repo</span><br><span class="line">yum install -y docker-ce docker-ce-cli containerd.io</span><br><span class="line"></span><br><span class="line"># docker 官方镜像阿里云加速</span><br><span class="line">mkdir -p /etc/docker</span><br><span class="line">tee /etc/docker/daemon.json &lt;&lt;-&apos;EOF&apos;</span><br><span class="line">&#123;</span><br><span class="line">  &quot;registry-mirrors&quot;: [&quot;https://r11fpimm.mirror.aliyuncs.com&quot;]</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"># 启动</span><br><span class="line">usermod -aG docker vagrant </span><br><span class="line">systemctl start docker</span><br><span class="line">systemctl enable docker</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>
</li>
<li><p>设置主机名</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cat &lt;&lt;EOF &gt;&gt; /Users/ada/vagjenkins/scripts/hosts.sh</span><br><span class="line">#!/bin/bash</span><br><span class="line"></span><br><span class="line">set -xe</span><br><span class="line"></span><br><span class="line">IFNAME=$1</span><br><span class="line">IP=&quot;$(ip -4 a s $IFNAME | grep &quot;inet&quot; | head -1 |awk &apos;&#123;print $2&#125;&apos; | cut -d&apos;/&apos; -f1)&quot;</span><br><span class="line">sed -e &quot;s/^.*$&#123;HOSTNAME&#125;.*/$&#123;IP&#125; $&#123;HOSTNAME&#125; $&#123;HOSTNAME&#125;/&quot; -i /etc/hosts</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>
</li>
<li><p>启动 docker registry 容器</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cat &lt;&lt;EOF &gt;&gt; /Users/ada/vagjenkins/scripts/registry.sh</span><br><span class="line">#!/bin/bash</span><br><span class="line"></span><br><span class="line">set -ex</span><br><span class="line"></span><br><span class="line"># run container</span><br><span class="line">docker pull registry:2.7.1</span><br><span class="line">docker run -d \</span><br><span class="line">  --restart=always \</span><br><span class="line">  --name registry \</span><br><span class="line">  -v `pwd`/registry:/var/lib/registry \</span><br><span class="line">  -v /vagrant/certs:/certs \</span><br><span class="line">  -e REGISTRY_HTTP_TLS_CERTIFICATE=/certs/domain.crt \</span><br><span class="line">  -e REGISTRY_HTTP_TLS_KEY=/certs/domain.key \</span><br><span class="line">  -p 5000:5000 \</span><br><span class="line">  registry:2.7.1</span><br><span class="line"></span><br><span class="line"># setup firewall, 因为 vagrant 镜像默认防火墙是关闭的，所以不用设置</span><br><span class="line">#firewall-cmd --permanent --add-port=8080/tcp</span><br><span class="line">#firewall-cmd --reload</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>
</li>
<li><p>安装 jdk 和 git，建议用 ssh 连接 git，一般有两种办法</p>
</li>
</ol>
<ul>
<li>如果是把 ssh 密钥放在服务器的话，必须得用 <code>ssh -T git@github.com</code> 连接 github，把 git 服务器指纹写入 known_hosts，否则构建不会在指纹提示自动输入 yes</li>
<li>只是安装 git，在 jenkins 创建新凭据，只需要填写 ssh 密钥，但每次使用时都需要指定用凭据，方便的是会自动采集指纹写入 known_hosts</li>
</ul>
<p>我这里选择了第二种方式，注意设置环境变量的 $ 符号不要被解析掉：<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cat &lt;&lt;EOF &gt;&gt; /Users/ada/vagjenkins/scripts/java.sh</span><br><span class="line">#!/bin/bash</span><br><span class="line"></span><br><span class="line">set -ex</span><br><span class="line"></span><br><span class="line"># untar jdk</span><br><span class="line">mkdir -p /usr/local/java</span><br><span class="line">tar -zxf /vagrant/jdk-8u211-linux-x64.tar.gz -C /usr/local/java/</span><br><span class="line"></span><br><span class="line"># set env</span><br><span class="line">cat &lt;&lt;EOF &gt;&gt; /home/vagrant/.bash_profile</span><br><span class="line">export JAVA_HOME=/usr/local/java/jdk1.8.0_211</span><br><span class="line">export JRE_HOME=\$&#123;JAVA_HOME&#125;/jre</span><br><span class="line">export CLASSPATH=.:\$&#123;JAVA_HOME&#125;/lib:\$&#123;JRE_HOME&#125;/lib</span><br><span class="line">export PATH=\$&#123;JAVA_HOME&#125;/bin:\$PATH</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">yum install -y git</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure></p>
<h3 id="7-3-nbsp-nbsp-运行-master-节点的-Jenkins"><a href="#7-3-nbsp-nbsp-运行-master-节点的-Jenkins" class="headerlink" title="7.3 &nbsp;&nbsp;运行 master 节点的 Jenkins"></a>7.3 &nbsp;&nbsp;运行 master 节点的 Jenkins</h3><p>完成以上步骤，启动虚拟机，用 java -jar /vagrant/jenkins.war 运行 Jenkins，因为 8080 已经映射到宿主机，所以可以在宿主机访问 Jenkins：localhost:8080。</p>
<h3 id="7-4-nbsp-nbsp-加入-node-从节点"><a href="#7-4-nbsp-nbsp-加入-node-从节点" class="headerlink" title="7.4 &nbsp;&nbsp;加入 node 从节点"></a>7.4 &nbsp;&nbsp;加入 node 从节点</h3><p>这里主要就把从节点的 ssh 私钥（服务器鉴权放在 /home/vagrant/.ssh/authorized_keys）生成 jenkins 的凭据，节点的 ssh 私钥可以通过 vagrant ssh [name] –debug 的输出日志中获取，一般放在 /Users/ada/vagjenkins/.vagrant/machines/[name]/virtualbox/private_key，通过 ssh、scp 去连接都需要该 private_key，例子如下：</p>
<ul>
<li><code>scp  -i /Users/ada/vagjenkins/.vagrant/machines/jenkins-node01/virtualbox/private_key  /Users/ada/.ssh/github/*  vagrant@192.168.56.114:/home/vagrant/.ssh</code>、</li>
<li>NAT 网络通过端口转发连接，<code>ssh -i /Users/ada/vagjenkins/.vagrant/machines/jenkins-master/virtualbox/private_key vagrant@127.0.0.1 -p 2222</code></li>
<li>因为我创建了主机网络，所以还可以直接通过主机网络的 IP 地址连接，<code>ssh -i /Users/ada/vagjenkins/.vagrant/machines/jenkins-master/virtualbox/private_key vagrant@192.168.56.113</code></li>
</ul>
<p>主节点通过 ssh 连接到从节点，同样需要 known_hosts 验证，在可以在服务器手动执行 <code>ssh vagrant@192.168.56.115</code> 验证再到 jenkins 启动节点。</p>
<h2 id="8-nbsp-nbsp-Troubleshooting"><a href="#8-nbsp-nbsp-Troubleshooting" class="headerlink" title="8 &nbsp;&nbsp;Troubleshooting"></a>8 &nbsp;&nbsp;Troubleshooting</h2><ul>
<li>Jenkins 出现更新出错的问题，一般就是 /etc/resolv.conf 解析出问题，可以用以下的方式查看：<br>curl -I –connect-timeout 10 -m 20  <a href="https://updates.jenkins.io/update-center.json" target="_blank" rel="noopener">https://updates.jenkins.io/update-center.json</a></li>
</ul>
<p><br><br><br> </p>
<p> <strong>参考文献</strong><br>[1] what-is-scrum. <a href="https://www.scrum.org/resources/what-is-scrum" target="_blank" rel="noopener">https://www.scrum.org/resources/what-is-scrum</a><br>[2] 如何从零开始搭建 CI/CD 流水线 <a href="https://www.infoq.cn/article/WHt0wFMDRrBU-dtkh1Xp" target="_blank" rel="noopener">https://www.infoq.cn/article/WHt0wFMDRrBU-dtkh1Xp</a></p>

      
    </div>
    <footer>
      
        
  
  <div class="categories">
    <a href="/categories/DevOps/">DevOps</a>
  </div>

        
  
  <div class="tags">
    <a href="/tags/Jenkins/">Jenkins</a>
  </div>

        
  <div class="addthis addthis_toolbox addthis_default_style">
    
      <a class="addthis_button_facebook_like" fb:like:layout="button_count"></a>
    
    
      <a class="addthis_button_tweet"></a>
    
    
      <a class="addthis_button_google_plusone" g:plusone:size="medium"></a>
    
    
      <a class="addthis_button_pinterest_pinit" pi:pinit:layout="horizontal"></a>
    
    <a class="addthis_counter addthis_pill_style"></a>
  </div>
  <script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js"></script>

      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>


<section id="comment">
  <h1 class="title">留言</h1>

  
  <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
  
</section>

</div></div>
    <aside id="sidebar" class="alignright">
  <div class="search">
  <form action="//google.com/search" method="get" accept-charset="utf-8">
    <input type="search" name="q" results="0" placeholder="搜索">
    <input type="hidden" name="q" value="site:blog.jemper.cn">
  </form>
</div>

  
<div class="widget tag">
  <h3 class="title">分类</h3>
  <ul class="entry">
  
    <li><a href="/categories/C/">C</a><small>1</small></li>
  
    <li><a href="/categories/DevOps/">DevOps</a><small>3</small></li>
  
    <li><a href="/categories/Docker/">Docker</a><small>4</small></li>
  
    <li><a href="/categories/Golang/">Golang</a><small>6</small></li>
  
    <li><a href="/categories/HTTP/">HTTP</a><small>5</small></li>
  
    <li><a href="/categories/云原生/">云原生</a><small>5</small></li>
  
    <li><a href="/categories/日记/">日记</a><small>2</small></li>
  
  </ul>
</div>


  
<div class="widget tagcloud">
  <h3 class="title">标签云</h3>
  <div class="entry">
    <a href="/tags/C/" style="font-size: 10px;">C</a> <a href="/tags/Docker/" style="font-size: 20px;">Docker</a> <a href="/tags/Golang/" style="font-size: 20px;">Golang</a> <a href="/tags/Go包/" style="font-size: 12.5px;">Go包</a> <a href="/tags/HTTP/" style="font-size: 15px;">HTTP</a> <a href="/tags/Jenkins/" style="font-size: 10px;">Jenkins</a> <a href="/tags/Kubernetes/" style="font-size: 17.5px;">Kubernetes</a> <a href="/tags/RPC/" style="font-size: 10px;">RPC</a> <a href="/tags/Socket/" style="font-size: 12.5px;">Socket</a> <a href="/tags/TCP/" style="font-size: 10px;">TCP</a> <a href="/tags/TLS/" style="font-size: 15px;">TLS</a> <a href="/tags/io/" style="font-size: 12.5px;">io</a> <a href="/tags/协议/" style="font-size: 15px;">协议</a> <a href="/tags/容器/" style="font-size: 15px;">容器</a> <a href="/tags/密码学/" style="font-size: 10px;">密码学</a> <a href="/tags/工具/" style="font-size: 15px;">工具</a> <a href="/tags/并发/" style="font-size: 12.5px;">并发</a> <a href="/tags/架构/" style="font-size: 10px;">架构</a> <a href="/tags/编程/" style="font-size: 10px;">编程</a> <a href="/tags/网络/" style="font-size: 12.5px;">网络</a> <a href="/tags/调试/" style="font-size: 10px;">调试</a>
  </div>
</div>

</aside>
    <div class="clearfix"></div>
  </div>
  <footer id="footer" class="inner"><div class="alignleft">
  
  &copy; 2019 Sven
  
</div>
<div class="clearfix"></div></footer>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>


<script type="text/javascript">
var disqus_shortname = 'wpxun';

(function(){
  var dsq = document.createElement('script');
  dsq.type = 'text/javascript';
  dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
}());
</script>



<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>

</body>
</html>
