<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>docker 入门与 docker-compose 编配工具 - 在路上的博客</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="基础docker操作 Dockerfile编写 Docker-compose.yml编写  基础docker操作安装docker 和 docker-compose 挺简单的，按 官方文档 安装就可以了，docker 1.13之后分化成了 Community Edition(CE) 和 Enterprise Edition(EE) 版本，前者免费，这也算是docker 发展的里程碑。安装完成后 s">
<meta property="og:type" content="article">
<meta property="og:title" content="docker 入门与 docker-compose 编配工具">
<meta property="og:url" content="http://blog.jemper.cn/2017/02/08/docker-and-dockerfile/index.html">
<meta property="og:site_name" content="在路上的博客">
<meta property="og:description" content="基础docker操作 Dockerfile编写 Docker-compose.yml编写  基础docker操作安装docker 和 docker-compose 挺简单的，按 官方文档 安装就可以了，docker 1.13之后分化成了 Community Edition(CE) 和 Enterprise Edition(EE) 版本，前者免费，这也算是docker 发展的里程碑。安装完成后 s">
<meta property="og:locale" content="zh-CN">
<meta property="og:updated_time" content="2019-03-12T09:03:12.344Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="docker 入门与 docker-compose 编配工具">
<meta name="twitter:description" content="基础docker操作 Dockerfile编写 Docker-compose.yml编写  基础docker操作安装docker 和 docker-compose 挺简单的，按 官方文档 安装就可以了，docker 1.13之后分化成了 Community Edition(CE) 和 Enterprise Edition(EE) 版本，前者免费，这也算是docker 发展的里程碑。安装完成后 s">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link href="/webfonts/ptserif/main.css" rel='stylesheet' type='text/css'>
  <link href="/webfonts/source-code-pro/main.css" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <!-- blair add baidu tongji start... @2017.10.03 -->
<!-- blair add baidu tongji end ! @2017.10.03 -->

<header id="header">
  <div id="header-outer" class="outer">
    <div id="header-inner" class="inner">
      <a id="main-nav-toggle" class="nav-icon" href="javascript:;"></a>
      <a id="logo" class="logo" href="/"></a>
      <nav id="main-nav">
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
          <a class="main-nav-link" href="/about">About</a>
        
      </nav>
      <nav id="sub-nav">
        <div id="search-form-wrap">
          <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://blog.jemper.cn"></form>
        </div>
      </nav>
    </div>
  </div>
</header>

    <br>
    <section id="main" class="outer"><article id="post-docker-and-dockerfile" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      docker 入门与 docker-compose 编配工具
      <small class=article-detail-date-index>&nbsp; 2017-02-08</small>
    </h1>
  


        <div class=page-title></div>
        <br>
      </header>
    
    <div class="article-meta">
      <!--<a href="/2017/02/08/docker-and-dockerfile/" class="article-date">
  <time datetime="2017-02-08T09:00:14.000Z" itemprop="datePublished">2017-02-08</time>
</a>-->
      <!-- 
--><!-- by blair 160724 -->
      <!-- by blair
      
        <div class="article-comment-link-wrap">
          <a href="http://blog.jemper.cn/2017/02/08/docker-and-dockerfile/#disqus_thread" class="article-comment-link">评论</a>
        </div>
      
      -->
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <ul>
<li>基础docker操作</li>
<li>Dockerfile编写</li>
<li>Docker-compose.yml编写</li>
</ul>
<h3 id="基础docker操作"><a href="#基础docker操作" class="headerlink" title="基础docker操作"></a>基础docker操作</h3><p>安装docker 和 docker-compose 挺简单的，按 <a href="https://store.docker.com/editions/community/docker-ce-server-centos?tab=description" target="_blank" rel="noopener">官方文档</a> 安装就可以了，docker 1.13之后分化成了 Community Edition(CE) 和 Enterprise Edition(EE) 版本，前者免费，这也算是docker 发展的里程碑。安装完成后 systemctl start docker、systemctl enable docker 自启动。  </p>
<p>这篇文章主要围绕 nginx 1.11 + php 7.1.3 + redis 3.1.1 + mysql 5.7 来讲解 docker 的操作过程。具体的知识也不会全面去讲解，仅仅是讲解需要用到的命令。更多的信息可以查阅官方文档。<br><a id="more"></a><br>从 hub.docker.com 拉取最新的镜像：</p>
<table>
<thead>
<tr>
<th>REPOSITORY</th>
<th>TAG</th>
<th>IMAGE ID</th>
<th>CREATED</th>
<th>SIZE</th>
</tr>
</thead>
<tbody>
<tr>
<td>php</td>
<td>7.1.3-fpm-alpine</td>
<td>e97e3208d019</td>
<td>2 days ago</td>
<td>69.6 MB</td>
</tr>
<tr>
<td>redis</td>
<td>3.2-alpine</td>
<td>83638a6d3af2</td>
<td>2 weeks ago</td>
<td>19.8 MB</td>
</tr>
<tr>
<td>nginx</td>
<td>1.11-alpine</td>
<td>0ae090dba3ab</td>
<td>2 weeks ago</td>
<td>54.3 MB</td>
</tr>
<tr>
<td>alpine</td>
<td>3.5</td>
<td>4a415e366388</td>
<td>2 weeks ago</td>
<td>3.98 MB</td>
</tr>
<tr>
<td>mysql</td>
<td>5.7</td>
<td>22be5748ecbe</td>
<td>2 weeks ago</td>
<td>406 MB</td>
</tr>
</tbody>
</table>
<p>可以看到，Alpine 系统只有3.98M，稳定性和安全性都是挺可靠的，至少我运行到现在没有出现任何问题。未来 docker 官方也会用 Alpine 取代 Ubuntu。这些只是基础的镜像，一些应用没有安装必要的扩展并不适合应用到产生环境。后面我会以上面的 php 和 nginx 基础镜像为例来创建出我们生产环境下的 php 和 nginx，并推送到 hub.docker.com 上，这样其它服务器也可以拉取。  </p>
<h4 id="常用命令："><a href="#常用命令：" class="headerlink" title="常用命令："></a>常用命令：</h4><ul>
<li>pull 拉取镜像，如docker pull php:7.1.3-fpm-alpine</li>
<li>push 推送镜像，注意使用前需要 docker login 登录  </li>
<li>inspect/network inspect 查看镜像、容器和网络  </li>
<li>ps 查看运行中的容器，常用的属性有 -a，还有其它的一些命令，如docker rm `docker ps -a -q`，docker network inspect $(docker network ls -q)  </li>
<li>images 查看镜像</li>
<li><p>run 常用参数 docker run –name nginx_server -d -p 80:80 –link php:php -v /Users/mylxsw/Dockers/php/nginx.conf:/etc/nginx/nginx.conf –volumes-from php nginx，需要注意的是：Docker容器后台运行,就必须有一个前台进程.<br>容器运行的命令如果不是那些一直挂起的命令（比如运行top，tail），就是会自动退出的<br>nginx 要以交互方式在前台运行，有两种方式：</p>
<ol>
<li>nginx -g “daemon off”. CMD 或者 ENTRYPOINT 两种方式。entrypoint</li>
<li>nginx.conf 加入 daemon off. 这样 run 指令就只要 nginx 就可以了</li>
</ol>
<p>也可以不加-d,并运行/bin/sh，依次输入ctrl+p、ctrl+q，就不会终止容器而只是退出。</p>
</li>
<li>exec 进入容器，如 docker exec -it e97e3208d019 /bin/sh，在运行中的容器内部额外启动进程，参数和 run 类似。直接exit 或 ctrl+D 不会退出容器</li>
<li>attach 可以附着到容器上，就相当于 run 的方式进入，直接 exit 或 ctrl+D 会退出容器</li>
<li>restart 或者 start 可以重启容器、stop 停止守护容器、rm 删除容器、rmi 删除镜像</li>
<li>build 基于基础镜像和 Dockerfile 构建新镜像，如 docker build -t wpxun/php:7.1.3 .</li>
</ul>
<p>上面的命令基本够用了，更多的命令可以查阅官方文档。</p>
<h3 id="Dockerfile编写"><a href="#Dockerfile编写" class="headerlink" title="Dockerfile编写"></a>Dockerfile编写</h3><p>1、php 很多扩展是没有安装的，所以还需在基础的镜像上创建出新的镜像。<br>需要的目录结构：</p>
<ul>
<li>composer.phar php 依赖管理器</li>
<li>Dockerfile  需要编写的dockerfile文件</li>
<li>php-cp-1.5.0.tar.gz  数据库或者redis 连接池</li>
<li>php.ini  php配置文件</li>
<li>pool.ini  连接池配置文件</li>
<li>redis-3.1.1.tgz  php-redis扩展</li>
<li>startup 因为需要启动pool_server 和 php fpm，所以就用一个脚本来运行了。</li>
</ul>
<p>Dockerfile 内容如下：<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">FROM php:7.1.3-fpm-alpine</span><br><span class="line"></span><br><span class="line">COPY php.ini /usr/local/etc/php/php.ini</span><br><span class="line">COPY pool.ini /etc/pool.ini</span><br><span class="line">COPY redis-3.1.1.tgz /usr/local/src/redis-3.1.1.tgz</span><br><span class="line">COPY php-cp-1.5.0.tar.gz /usr/local/src/php-cp-1.5.0.tar.gz</span><br><span class="line">COPY composer.phar /usr/local/bin/composer</span><br><span class="line">COPY startup /run</span><br><span class="line">RUN docker-php-source extract \</span><br><span class="line">    &amp;&amp; cd /usr/local/src \</span><br><span class="line">    &amp;&amp; tar xzf redis-3.1.1.tgz \</span><br><span class="line">    &amp;&amp; tar xzf php-cp-1.5.0.tar.gz \</span><br><span class="line">    &amp;&amp; rm redis-3.1.1.tgz php-cp-1.5.0.tar.gz \</span><br><span class="line">    &amp;&amp; mv redis-3.1.1 /usr/src/php/ext/redis \</span><br><span class="line">    &amp;&amp; cp -r php-cp-1.5.0 /usr/src/php/ext/phpcp \</span><br><span class="line">    &amp;&amp; docker-php-ext-install redis \</span><br><span class="line">    &amp;&amp; docker-php-ext-install phpcp \</span><br><span class="line">    &amp;&amp; docker-php-source delete \</span><br><span class="line">    &amp;&amp; docker-php-ext-install pdo_mysql \</span><br><span class="line">    &amp;&amp; apk add --no-cache --virtual .build-deps libmcrypt-dev icu-dev libxslt-dev \</span><br><span class="line">    &amp;&amp; docker-php-ext-install -j$(getconf _NPROCESSORS_ONLN) iconv mcrypt zip mcrypt intl xsl \</span><br><span class="line">    &amp;&amp; apk add --no-cache freetype-dev libjpeg-turbo-dev libpng-dev \</span><br><span class="line">    &amp;&amp; docker-php-ext-configure gd --with-freetype-dir=/usr/include/ --with-jpeg-dir=/usr/include/ \</span><br><span class="line">    &amp;&amp; docker-php-ext-install -j$(getconf _NPROCESSORS_ONLN) gd \</span><br><span class="line">    &amp;&amp; chmod +x /usr/local/bin/composer \</span><br><span class="line">    &amp;&amp; chmod +x /run/startup</span><br><span class="line"></span><br><span class="line">CMD [&quot;/run/startup&quot;]</span><br></pre></td></tr></table></figure></p>
<p>startup 内容如下：<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#!/bin/sh</span><br><span class="line">cd /usr/local/src/php-cp-1.5.0;</span><br><span class="line">php pool_server start</span><br><span class="line">php-fpm</span><br></pre></td></tr></table></figure></p>
<p>2、nginx 安装 debug 调试扩展。<br>需要的目录结构：</p>
<ul>
<li>Dockerfile  需要编写的dockerfile文件</li>
<li>nginx.conf  nginx 配置文件</li>
<li>nginx.vh.default.conf php  nginx 配置文件</li>
</ul>
<p>Dockerfile 内容如下：这部分我也没怎么改，就是加了 –with-debug \，COPY 的时候指向本地的文件<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">FROM alpine:3.4</span><br><span class="line"></span><br><span class="line">MAINTAINER NGINX Docker Maintainers &quot;docker-maint@nginx.com&quot;</span><br><span class="line"></span><br><span class="line">ENV NGINX_VERSION 1.11.10</span><br><span class="line"></span><br><span class="line">RUN GPG_KEYS=B0F4253373F8F6F510D42178520A9993A1C052F8 \</span><br><span class="line">        &amp;&amp; CONFIG=&quot;\</span><br><span class="line">                --prefix=/etc/nginx \</span><br><span class="line">                --sbin-path=/usr/sbin/nginx \</span><br><span class="line">                --modules-path=/usr/lib/nginx/modules \</span><br><span class="line">                --conf-path=/etc/nginx/nginx.conf \</span><br><span class="line">                --error-log-path=/var/log/nginx/error.log \</span><br><span class="line">                --http-log-path=/var/log/nginx/access.log \</span><br><span class="line">                --pid-path=/var/run/nginx.pid \</span><br><span class="line">                --lock-path=/var/run/nginx.lock \</span><br><span class="line">                --http-client-body-temp-path=/var/cache/nginx/client_temp \</span><br><span class="line">                --http-proxy-temp-path=/var/cache/nginx/proxy_temp \</span><br><span class="line">                --http-fastcgi-temp-path=/var/cache/nginx/fastcgi_temp \</span><br><span class="line">                --http-uwsgi-temp-path=/var/cache/nginx/uwsgi_temp \</span><br><span class="line">                --http-scgi-temp-path=/var/cache/nginx/scgi_temp \</span><br><span class="line">                --user=nginx \</span><br><span class="line">                --group=nginx \</span><br><span class="line">                --with-http_ssl_module \</span><br><span class="line">                --with-http_realip_module \</span><br><span class="line">                --with-http_addition_module \</span><br><span class="line">                --with-http_sub_module \</span><br><span class="line">                --with-http_dav_module \</span><br><span class="line">                --with-http_flv_module \</span><br><span class="line">                --with-http_mp4_module \</span><br><span class="line">                --with-http_gunzip_module \</span><br><span class="line">                --with-http_gzip_static_module \</span><br><span class="line">                --with-http_random_index_module \</span><br><span class="line">                --with-http_secure_link_module \</span><br><span class="line">                --with-http_stub_status_module \</span><br><span class="line">                --with-http_auth_request_module \</span><br><span class="line">                --with-http_xslt_module=dynamic \</span><br><span class="line">                --with-http_image_filter_module=dynamic \</span><br><span class="line">                --with-http_geoip_module=dynamic \</span><br><span class="line">                --with-http_perl_module=dynamic \</span><br><span class="line">                --with-threads \</span><br><span class="line">                --with-stream \</span><br><span class="line">                --with-stream_ssl_module \</span><br><span class="line">                --with-stream_ssl_preread_module \</span><br><span class="line">                --with-stream_realip_module \</span><br><span class="line">                --with-stream_geoip_module=dynamic \</span><br><span class="line">                --with-http_slice_module \</span><br><span class="line">                --with-mail \</span><br><span class="line">                --with-mail_ssl_module \</span><br><span class="line">                --with-compat \</span><br><span class="line">                --with-file-aio \</span><br><span class="line">                --with-http_v2_module \</span><br><span class="line">                --with-debug \</span><br><span class="line">        &quot; \</span><br><span class="line">        &amp;&amp; addgroup -S nginx \</span><br><span class="line">        &amp;&amp; adduser -D -S -h /var/cache/nginx -s /sbin/nologin -G nginx nginx \</span><br><span class="line">        &amp;&amp; apk add --no-cache --virtual .build-deps \</span><br><span class="line">                gcc \</span><br><span class="line">                libc-dev \</span><br><span class="line">                make \</span><br><span class="line">                openssl-dev \</span><br><span class="line">                pcre-dev \</span><br><span class="line">                zlib-dev \</span><br><span class="line">                linux-headers \</span><br><span class="line">                curl \</span><br><span class="line">                gnupg \</span><br><span class="line">                libxslt-dev \</span><br><span class="line">                gd-dev \</span><br><span class="line">                geoip-dev \</span><br><span class="line">                perl-dev \</span><br><span class="line">        &amp;&amp; curl -fSL http://nginx.org/download/nginx-$NGINX_VERSION.tar.gz -o nginx.tar.gz \</span><br><span class="line">        &amp;&amp; curl -fSL http://nginx.org/download/nginx-$NGINX_VERSION.tar.gz.asc  -o nginx.tar.gz.asc \</span><br><span class="line">        &amp;&amp; export GNUPGHOME=&quot;$(mktemp -d)&quot; \</span><br><span class="line">        &amp;&amp; gpg --keyserver ha.pool.sks-keyservers.net --recv-keys &quot;$GPG_KEYS&quot; \</span><br><span class="line">        &amp;&amp; gpg --batch --verify nginx.tar.gz.asc nginx.tar.gz \</span><br><span class="line">        &amp;&amp; rm -r &quot;$GNUPGHOME&quot; nginx.tar.gz.asc \</span><br><span class="line">        &amp;&amp; mkdir -p /usr/src \</span><br><span class="line">        &amp;&amp; tar -zxC /usr/src -f nginx.tar.gz \</span><br><span class="line">        &amp;&amp; rm nginx.tar.gz \</span><br><span class="line">        &amp;&amp; cd /usr/src/nginx-$NGINX_VERSION \</span><br><span class="line">        &amp;&amp; ./configure $CONFIG --with-debug \</span><br><span class="line">        &amp;&amp; make -j$(getconf _NPROCESSORS_ONLN) \</span><br><span class="line">        &amp;&amp; mv objs/nginx objs/nginx-debug \</span><br><span class="line">        &amp;&amp; mv objs/ngx_http_xslt_filter_module.so objs/ngx_http_xslt_filter_module-debug.so \</span><br><span class="line">        &amp;&amp; mv objs/ngx_http_image_filter_module.so objs/ngx_http_image_filter_module-debug.so \</span><br><span class="line">        &amp;&amp; mv objs/ngx_http_geoip_module.so objs/ngx_http_geoip_module-debug.so \</span><br><span class="line">        &amp;&amp; mv objs/ngx_http_perl_module.so objs/ngx_http_perl_module-debug.so \</span><br><span class="line">        &amp;&amp; mv objs/ngx_stream_geoip_module.so objs/ngx_stream_geoip_module-debug.so \</span><br><span class="line">        &amp;&amp; ./configure $CONFIG \</span><br><span class="line">        &amp;&amp; make -j$(getconf _NPROCESSORS_ONLN) \</span><br><span class="line">        &amp;&amp; make install \</span><br><span class="line">        &amp;&amp; rm -rf /etc/nginx/html/ \</span><br><span class="line">        &amp;&amp; mkdir /etc/nginx/conf.d/ \</span><br><span class="line">        &amp;&amp; mkdir -p /usr/share/nginx/html/ \</span><br><span class="line">        &amp;&amp; install -m644 html/index.html /usr/share/nginx/html/ \</span><br><span class="line">        &amp;&amp; install -m644 html/50x.html /usr/share/nginx/html/ \</span><br><span class="line">        &amp;&amp; install -m755 objs/nginx-debug /usr/sbin/nginx-debug \</span><br><span class="line">        &amp;&amp; install -m755 objs/ngx_http_xslt_filter_module-debug.so /usr/lib/nginx/modules/ngx_http_xslt_filter_module-debug.so \</span><br><span class="line">        &amp;&amp; install -m755 objs/ngx_http_image_filter_module-debug.so /usr/lib/nginx/modules/ngx_http_image_filter_module-debug.so \</span><br><span class="line">        &amp;&amp; install -m755 objs/ngx_http_geoip_module-debug.so /usr/lib/nginx/modules/ngx_http_geoip_module-debug.so \</span><br><span class="line">        &amp;&amp; install -m755 objs/ngx_http_perl_module-debug.so /usr/lib/nginx/modules/ngx_http_perl_module-debug.so \</span><br><span class="line">        &amp;&amp; install -m755 objs/ngx_stream_geoip_module-debug.so /usr/lib/nginx/modules/ngx_stream_geoip_module-debug.so \</span><br><span class="line">        &amp;&amp; ln -s ../../usr/lib/nginx/modules /etc/nginx/modules \</span><br><span class="line">        &amp;&amp; strip /usr/sbin/nginx* \</span><br><span class="line">        &amp;&amp; strip /usr/lib/nginx/modules/*.so \</span><br><span class="line">        &amp;&amp; rm -rf /usr/src/nginx-$NGINX_VERSION \</span><br><span class="line">        \</span><br><span class="line">        # Bring in gettext so we can get `envsubst`, then throw</span><br><span class="line">        # the rest away. To do this, we need to install `gettext`</span><br><span class="line">        # then move `envsubst` out of the way so `gettext` can</span><br><span class="line">        # be deleted completely, then move `envsubst` back.</span><br><span class="line">        &amp;&amp; apk add --no-cache --virtual .gettext gettext \</span><br><span class="line">        &amp;&amp; mv /usr/bin/envsubst /tmp/ \</span><br><span class="line">        \</span><br><span class="line">        &amp;&amp; runDeps=&quot;$( \</span><br><span class="line">                scanelf --needed --nobanner /usr/sbin/nginx /usr/lib/nginx/modules/*.so /tmp/envsubst \</span><br><span class="line">                        | awk &apos;&#123; gsub(/,/, &quot;\nso:&quot;, $2); print &quot;so:&quot; $2 &#125;&apos; \</span><br><span class="line">                        | sort -u \</span><br><span class="line">                        | xargs -r apk info --installed \</span><br><span class="line">                        | sort -u \</span><br><span class="line">        )&quot; \</span><br><span class="line">        &amp;&amp; apk add --no-cache --virtual .nginx-rundeps $runDeps \</span><br><span class="line">        &amp;&amp; apk del .build-deps \</span><br><span class="line">        &amp;&amp; apk del .gettext \</span><br><span class="line">        &amp;&amp; mv /tmp/envsubst /usr/local/bin/ \</span><br><span class="line">        \</span><br><span class="line">        # forward request and error logs to docker log collector</span><br><span class="line">        &amp;&amp; ln -sf /dev/stdout /var/log/nginx/access.log \</span><br><span class="line">        &amp;&amp; ln -sf /dev/stderr /var/log/nginx/error.log</span><br><span class="line"></span><br><span class="line">COPY nginx.conf /etc/nginx/nginx.conf</span><br><span class="line">COPY nginx.vh.default.conf /etc/nginx/conf.d/default.conf</span><br><span class="line"></span><br><span class="line">EXPOSE 80 443</span><br><span class="line"></span><br><span class="line">CMD [&quot;nginx&quot;, &quot;-g&quot;, &quot;daemon off;&quot;]</span><br></pre></td></tr></table></figure></p>
<p>根据上面就可以构建出生产环境的 php 和 nginx 了。</p>
<ul>
<li>docker build -t wpxun/php:7.1.3 .</li>
<li>docker build -t wpxun/nginx:1.11 .</li>
</ul>
<p>然后push 到 hub.docker.com  </p>
<h3 id="Docker-compose-yml编写"><a href="#Docker-compose-yml编写" class="headerlink" title="Docker-compose.yml编写"></a>Docker-compose.yml编写</h3><p>Docker-compose.yml 文件内容如下：<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">version: &apos;2&apos;</span><br><span class="line">services:</span><br><span class="line">    nginx:</span><br><span class="line">        image: wpxun/nginx:1.0</span><br><span class="line">        build: ./nginx</span><br><span class="line">        ports:</span><br><span class="line">            - 80:80</span><br><span class="line">            - 443:443</span><br><span class="line">        links:</span><br><span class="line">            - fpm</span><br><span class="line">        volumes:</span><br><span class="line">            - /var/www:/var/www</span><br><span class="line">    fpm:</span><br><span class="line">        image: wpxun/fpm:7.1</span><br><span class="line">        build: ./php</span><br><span class="line">        links:</span><br><span class="line">            - redis</span><br><span class="line">            - mysql</span><br><span class="line">        volumes:</span><br><span class="line">            - /var/www:/var/www</span><br><span class="line">    redis:</span><br><span class="line">        image: redis:3.2-alpine</span><br><span class="line">        ports:</span><br><span class="line">            - 6379:6379</span><br><span class="line">#        network_mode: &quot;host&quot;</span><br><span class="line">    mysql:</span><br><span class="line">        image: mysql:5.7</span><br><span class="line">        ports:</span><br><span class="line">            - 3306:3306</span><br><span class="line">        environment:</span><br><span class="line">            - MYSQL_ROOT_PASSWORD=xxhhhhxx</span><br><span class="line">#        network_mode: &quot;host&quot;</span><br><span class="line">        volumes:</span><br><span class="line">            - /var/mysql/:/var/lib/mysql</span><br></pre></td></tr></table></figure></p>
<hr>
<h3 id="相关连接"><a href="#相关连接" class="headerlink" title="相关连接"></a>相关连接</h3><p><a href="https://docs.docker.com/engine/userguide/eng-image/dockerfile_best-practices/" target="_blank" rel="noopener">Dockerfile 最佳实践</a></p>

      
     <!-- by blair add this if sentence at 20160725 -->
      <br>
      
<div id="bottom-donation-section">
</div>
<div class="well">
  原创文章，转载请注明： 转载自<a href="http://blog.jemper.cn"> wpxun's Blog</a>，作者：
  <a href="http://blog.jemper.cn">wpxun</a> <br>
  本文基于<a target="_blank" title="Creative Commons Attribution 4.0 international License" href="https://creativecommons.org/licenses/by-nc/4.0/">署名4.0国际许可协议</a>发布，转载请保留本文署名和文章链接。 如您有任何授权方面的协商，请邮件联系我。
</div>

 <!-- by blair add 160724-->
    
    </div>
    
      <div class="article-toc">
        <h3>目录</h3>
        <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#基础docker操作"><span class="toc-number">1.</span> <span class="toc-text">基础docker操作</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#常用命令："><span class="toc-number">1.1.</span> <span class="toc-text">常用命令：</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Dockerfile编写"><span class="toc-number">2.</span> <span class="toc-text">Dockerfile编写</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Docker-compose-yml编写"><span class="toc-number">3.</span> <span class="toc-text">Docker-compose.yml编写</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#相关连接"><span class="toc-number">4.</span> <span class="toc-text">相关连接</span></a></li></ol>
      </div>
    
    
      <footer class="article-footer">
        <!-- <div class="well" style="width:100px; height:30px;"></div>  by blair-->
        
 <!-- by blair add 160724-->
        <!--
        <div style="width:100px; height:30px;"></div> by blair add 160724
        -->
        

      </footer>
    
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2017/02/10/git-source/" id="article-nav-newer" class="article-nav-link-wrap">
      <div class="article-nav-title"><span>&lt;</span>&nbsp;
        
          git 源码安装
        
      </div>
    </a>
  
  
    <a href="/2017/02/08/start-hexo/" id="article-nav-older" class="article-nav-link-wrap">
      <div class="article-nav-title">Hexo 实践&nbsp;<span>&gt;</span></div>
    </a>
  
</nav>

  
</article>

<section id="comments">
  <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
</section>

</section>
    <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2019 Sven&nbsp;
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>, theme by <a href="http://github.com/52binge/hexo-theme-blairos">blairos</a>, <a href="http://www.miitbeian.gov.cn/" target="_blank"> 粤ICP备15111870号-1 </a>
    </div>
  </div>
</footer>

    
<script type="text/javascript"> <!-- add by blair 0724 type=text/javascript -->
  var disqus_shortname = 'wpxun';
  
  var disqus_url = 'http://blog.jemper.cn/2017/02/08/docker-and-dockerfile/';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="/js/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>
